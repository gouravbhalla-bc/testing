ARG ALT_REPO_PYPI=pypi.altono.app
FROM python:3.7-slim as test
ARG ALT_REPO_PYPI
WORKDIR /code
COPY requirements.txt requirements.txt
COPY test_requirements.txt test_requirements.txt
RUN apt-get update
RUN apt-get -y install gcc
RUN pip install -r requirements.txt --extra-index-url=https://${ALT_REPO_PYPI} --trusted-host=${ALT_REPO_PYPI} --use-deprecated=legacy-resolver
RUN pip install --extra-index-url=https://${ALT_REPO_PYPI} --trusted-host=${ALT_REPO_PYPI} -r test_requirements.txt
COPY . .
CMD ["./scripts/test.sh"]
